<meta name="viewport" content="width=device-width, initial-scale=1" />

<script>
// Generated by Haxe 3.4.2 (git build master @ 890f8c7)
(function () { "use strict";
var HxOverrides = function() { };
HxOverrides.substr = function(s,pos,len) {
	if(len == null) {
		len = s.length;
	} else if(len < 0) {
		if(pos == 0) {
			len = s.length + len;
		} else {
			return "";
		}
	}
	return s.substr(pos,len);
};
HxOverrides.remove = function(a,obj) {
	var i = a.indexOf(obj);
	if(i == -1) {
		return false;
	}
	a.splice(i,1);
	return true;
};
var Function1 = function(name,length,location) {
	this.name = name;
	this.length = length;
	this.location = location;
};
var Toeve = function() { };
Toeve.main = function() {
	var s = "function $2f1 p1\nfunction p1 $1f2 p2\nf1 p11v f2 p22v\nf1 p11v";
	var s1 = "function f1/1 p1\nfunction f2 p1 p2\nf2 p1v f1/1 p1v\nf1/1 p1v";
	console.log(Toeve.r2e(s));
};
Toeve.r2e = function(s) {
	var s1 = s;
	var lines = s1.split("\n");
	var defines = new haxe_ds_StringMap();
	var functionType = new haxe_ds_StringMap();
	var priority = new haxe_ds_StringMap();
	var para = [];
	var func = [];
	var a2s = function(a1) {
		var a = a1.slice();
		var result = "[";
		var function_name = a.shift().substring(1);
		result += "#" + function_name;
		var _g1 = 0;
		var _g = a.length;
		while(_g1 < _g) {
			var i = _g1++;
			if(HxOverrides.substr(a[i],0,1) == "[") {
				result += " " + (__map_reserved[function_name] != null ? defines.getReserved(function_name) : defines.h[function_name])[i] + ":" + a[i];
			} else {
				result += " " + (__map_reserved[function_name] != null ? defines.getReserved(function_name) : defines.h[function_name])[i] + ":" + "\"" + a[i] + "\"";
			}
		}
		result += "]";
		return result;
	};
	var listIt3 = function() {
		var thisFunction = func.pop();
		var name = thisFunction.name;
		var length = thisFunction.length;
		var location = thisFunction.location;
		var vars = para.splice(location,length);
		vars.unshift("#" + name);
		var x = a2s(vars);
		para.splice(location,0,x);
	};
	var listIt2 = function() {
		while(func.length > 0) listIt3();
	};
	var listIt1 = null;
	listIt1 = function(input1) {
		var input = input1.slice();
		if(input.length == 0) {
			return 1;
		}
		var word = input.shift();
		if(__map_reserved[word] != null ? defines.existsReserved(word) : defines.h.hasOwnProperty(word)) {
			while(true) {
				var listIt11;
				if(func.length > 0 && para.length - func[func.length - 1].location == func[func.length - 1].length) {
					var listIt12 = __map_reserved[word] != null ? priority.getReserved(word) : priority.h[word];
					var key = func[func.length - 1].name;
					listIt11 = listIt12 <= (__map_reserved[key] != null ? priority.getReserved(key) : priority.h[key]);
				} else {
					listIt11 = false;
				}
				if(!listIt11) {
					break;
				}
				listIt3();
			}
			var function_length = (__map_reserved[word] != null ? defines.getReserved(word) : defines.h[word]).length;
			var function_location = para.length - (__map_reserved[word] != null ? functionType.getReserved(word) : functionType.h[word]);
			func.push(new Function1(word,function_length,function_location));
		} else {
			para.push(word);
		}
		return listIt1(input);
	};
	var listIt13 = listIt1;
	var listIt = function(a2) {
		listIt13(a2);
		listIt2();
		var result1 = para[0];
		para = [];
		return result1;
	};
	var result2 = "```eve\ncommit";
	var _g2 = 0;
	while(_g2 < lines.length) {
		var line = lines[_g2];
		++_g2;
		var words = line.split(" ");
		var key1 = "";
		var toRemove = "";
		if(words[0] == "function") {
			words.shift();
			var _g21 = 0;
			var _g11 = words.length;
			while(_g21 < _g11) {
				var i1 = _g21++;
				if(HxOverrides.substr(words[i1],0,1) == "$") {
					toRemove = words[i1];
					key1 = words[i1].substring(2);
					if(__map_reserved[key1] != null) {
						functionType.setReserved(key1,i1);
					} else {
						functionType.h[key1] = i1;
					}
					var v = HxOverrides.substr(words[i1],1,1);
					if(__map_reserved[key1] != null) {
						priority.setReserved(key1,v);
					} else {
						priority.h[key1] = v;
					}
				}
			}
			HxOverrides.remove(words,toRemove);
			if(__map_reserved[key1] != null) {
				defines.setReserved(key1,words);
			} else {
				defines.h[key1] = words;
			}
		} else {
			result2 += "\n" + listIt(words);
		}
	}
	result2 += "\n```";
	return result2;
};
var haxe_IMap = function() { };
var haxe_ds_StringMap = function() {
	this.h = { };
};
haxe_ds_StringMap.__interfaces__ = [haxe_IMap];
haxe_ds_StringMap.prototype = {
	setReserved: function(key,value) {
		if(this.rh == null) {
			this.rh = { };
		}
		this.rh["$" + key] = value;
	}
	,getReserved: function(key) {
		if(this.rh == null) {
			return null;
		} else {
			return this.rh["$" + key];
		}
	}
	,existsReserved: function(key) {
		if(this.rh == null) {
			return false;
		}
		return this.rh.hasOwnProperty("$" + key);
	}
};
var __map_reserved = {}
window.$toeve=Toeve.r2e;
Toeve.main();
})();


  function toeve_exe(){
      output1.value=window.$toeve(input1.value);
  }
</script>

<style>
  body {
  display: flex;
  flex-direction: column;
  }
  div {
  display: flex;
  flex-direction: row;
  height:100%;
  }
  span {
  width:100%;
  height:100%;
  }
  textarea {
  width:100%;
  height:100%;
  }
</style>
<body>
<button onclick="javascript:toeve_exe();">
  r2e
</button>
<div>
  <span>
    in
    <br />
    <textarea id="input1">function thing $2of limit
function subject $1be judgment
function $3the object
the capital of china be beijing</textarea>
  </span>
  <span>
    out
    <br />
    <textarea id="output1"></textarea>
  </span>
</div>
</body>